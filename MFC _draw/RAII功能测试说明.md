# RAII 错误处理功能测试说明

## 一、编译测试

### 1.1 基本编译测试
- 编译整个项目，确保没有编译错误
- 检查所有警告信息
- 确保所有文件正确链接

### 1.2 验证步骤
1. 在 Visual Studio 中打开项目
2. 选择 "生成" -> "重新生成解决方案"
3. 检查输出窗口，确保没有错误
4. 检查是否有关于 GDI 对象使用的警告

---

## 二、功能测试（正常情况）

### 2.1 绘图功能测试
测试所有绘图功能是否正常工作：

#### 测试步骤：
1. **线段绘制**
   - 选择线段工具
   - 在画布上绘制多条线段
   - 验证线段正确显示

2. **矩形绘制**
   - 选择矩形工具
   - 绘制多个矩形
   - 验证矩形正确显示

3. **圆形绘制**
   - 选择圆形工具
   - 绘制多个圆形
   - 验证圆形正确显示

4. **椭圆绘制**
   - 选择椭圆工具
   - 绘制多个椭圆
   - 验证椭圆正确显示

5. **铅笔工具**
   - 选择铅笔工具
   - 连续绘制曲线
   - 验证曲线正确显示

6. **橡皮擦工具**
   - 选择橡皮擦工具
   - 擦除已绘制的内容
   - 验证擦除功能正常

7. **文本输入**
   - 选择文本工具
   - 输入文本
   - 验证文本正确显示

### 2.2 撤销/重做测试
- 执行多个绘图操作
- 测试撤销功能
- 测试重做功能
- 验证命令栈正常工作

### 2.3 文件操作测试
- **打开文件**：打开一个 BMP 图片文件
- **保存文件**：将画布内容保存为不同格式（BMP、JPG、PNG等）

---

## 三、异常处理测试

### 3.1 测试异常捕获
在代码中添加测试代码，验证异常处理是否正常工作。

### 3.2 资源耗尽测试
1. 创建大量 GDI 对象（在循环中）
2. 验证资源是否正确释放
3. 使用任务管理器或 Process Explorer 监控 GDI 对象数量

### 3.3 无效参数测试
测试传入无效参数时的行为：
- 空指针
- 无效的颜色值
- 无效的尺寸值

---

## 四、资源泄漏检测

### 4.1 使用任务管理器
1. 打开任务管理器（Ctrl+Shift+Esc）
2. 切换到 "详细信息" 标签
3. 找到应用程序进程
4. 查看 "GDI 对象" 列
5. 执行大量绘图操作
6. 观察 GDI 对象数量是否稳定（不应该持续增长）

### 4.2 使用 Process Explorer
1. 下载并运行 Process Explorer
2. 找到应用程序进程
3. 查看 GDI Handles 计数
4. 执行操作并观察计数变化

### 4.3 长时间运行测试
1. 运行应用程序
2. 执行大量绘图操作（100+ 次）
3. 运行 10-30 分钟
4. 检查是否有内存泄漏或 GDI 对象泄漏

---

## 五、代码审查检查点

### 5.1 检查所有 GDI 对象使用
搜索代码中的以下模式，确保都已替换：
- `CPen newPen; newPen.CreatePen(...)`
- `CBrush newBrush; newBrush.CreateSolidBrush(...)`
- `CFont font; font.CreateFontIndirect(...)`
- `HBITMAP hBitmap = CreateCompatibleBitmap(...)`
- `HDC hdc = CreateCompatibleDC(...)`

### 5.2 检查异常处理
- 所有 GDI 操作是否都在 try-catch 块中
- 异常是否被正确捕获和处理
- 是否有适当的错误消息

---

## 六、性能测试

### 6.1 绘制性能
- 测试绘制大量图形时的性能
- 验证 RAII 包装没有引入明显的性能开销

### 6.2 内存使用
- 监控内存使用情况
- 验证没有内存泄漏

---

## 七、测试结果记录

建议记录以下信息：
- 测试日期和时间
- 测试环境（操作系统版本、Visual Studio 版本）
- 测试结果（通过/失败）
- 发现的问题
- GDI 对象数量变化
- 异常情况记录

---

## 八、自动化测试建议

可以创建单元测试来验证：
1. GDI 对象创建和销毁
2. 异常处理机制
3. 资源自动释放
4. SelectObject 的自动恢复

